<?php

namespace Database\Seeders;

use App\Models\Category;
use App\Models\Dish;
use App\Models\Ingredient;
use Illuminate\Database\Seeder;

class DishSeeder extends Seeder
{
    public function run(): void
    {
        $categories = Category::pluck('id', 'name');

        // Helper to get ingredient ID
        $ing = fn($name) => Ingredient::where('name', $name)->first()?->id;

        $recipe_tomato_scrambled_eggs = <<<EOT
## ðŸ… å®¶å¸¸è¥¿çº¢æŸ¿ç‚’é¸¡è›‹

### ðŸ›’ å‡†å¤‡é£Ÿæ

* **ä¸»æ–™**ï¼š
* é¸¡è›‹ï¼š3-4 ä¸ª
* è¥¿çº¢æŸ¿ï¼ˆä¸­ç­‰å¤§å°ï¼‰ï¼š2-3 ä¸ªï¼ˆå»ºè®®é€‰çº¢é€çš„ï¼Œæ±æ°´æ›´å¤šï¼‰


* **è¾…æ–™**ï¼š
* å¤§è‘±ï¼šä¸€å°æ®µï¼ˆåˆ‡æˆè‘±èŠ±ï¼‰
* å¤§è’œï¼š2 ç“£ï¼ˆåˆ‡æœ«ï¼Œä¸å–œæ¬¢è’œå‘³å¯ä¸æ”¾ï¼‰


* **è°ƒæ–™**ï¼š
* é£Ÿç”¨æ²¹ï¼šé€‚é‡
* ç›ï¼š1 å°å‹º
* ç™½ç³–ï¼š1 å‹ºï¼ˆå…³é”®ç‚¹ï¼Œç”¨æ¥ä¸­å’Œé…¸å‘³å¹¶æé²œï¼‰
* ç•ªèŒ„é…±ï¼š1 å‹ºï¼ˆå¯é€‰ï¼Œå¦‚æžœè¥¿çº¢æŸ¿ä¸å¤Ÿçº¢æˆ–æƒ³è¦æ±¤æ±æ›´æµ“éƒæŽ¨èåŠ ï¼‰
* æ¸…æ°´ï¼šå°‘è®¸



---

### ðŸ”ª å¤‡èœæ­¥éª¤

1. **å¤„ç†è¥¿çº¢æŸ¿**ï¼šæ´—å‡€ï¼Œåˆ‡æˆæ©˜å­ç“£å¤§å°çš„å—ã€‚
> **å°çªé—¨**ï¼šå¦‚æžœä½ ä¸å–œæ¬¢åƒè¥¿çº¢æŸ¿çš®ï¼Œå¯ä»¥åœ¨è¥¿çº¢æŸ¿é¡¶ç«¯åˆ’åå­—ï¼Œç”¨å¼€æ°´çƒ«ä¸€ä¸‹åŽ»çš®åŽå†åˆ‡å—ã€‚ä¸è¿‡å¸¦çš®ç‚’æ›´æœ‰åš¼åŠ²ï¼Œçœ‹ä¸ªäººå–œå¥½ã€‚


2. **å¤„ç†é¸¡è›‹**ï¼šå°†é¸¡è›‹æ‰“å…¥ç¢—ä¸­ï¼ŒåŠ å°‘è®¸ç›ï¼ˆåº•å‘³ï¼‰å’Œå‡ æ»´æ°´ï¼ˆè®©è›‹æ›´å«©ï¼‰ï¼Œç”¨ç­·å­å……åˆ†æ‰“æ•£ï¼Œç›´åˆ°è›‹æ¶²è¡¨é¢æœ‰ä¸°å¯Œæ°”æ³¡ã€‚
3. **å‡†å¤‡é…æ–™**ï¼šåˆ‡å¥½è‘±èŠ±å’Œè’œæœ«å¤‡ç”¨ã€‚

---

### ðŸ³ çƒ¹é¥ªæ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šç‚’é¸¡è›‹

1. çƒ­é”…çƒ§æ²¹ï¼Œæ²¹æ¸©è¦ç¨é«˜ä¸€ç‚¹ï¼ˆå†’å¾®å¾®é’çƒŸï¼‰ã€‚
2. å€’å…¥è›‹æ¶²ï¼Œç”¨é“²å­å¿«é€Ÿåˆ’æ•£ã€‚
3. å½“è›‹æ¶²å¤§éƒ¨åˆ†å‡å›ºä½†è¿˜å¾ˆå«©çš„æ—¶å€™ï¼Œç«‹åˆ»ç››å‡ºå¤‡ç”¨ã€‚**ä¸è¦ç‚’è€äº†**ã€‚

#### ç¬¬äºŒæ­¥ï¼šç‚’å‡ºçº¢æ²¹ï¼ˆçµé­‚æ­¥éª¤ï¼‰

1. é”…ä¸­ä¸ç”¨æ´—ï¼Œå†åŠ å°‘è®¸åº•æ²¹ã€‚
2. æ”¾å…¥è‘±èŠ±ï¼ˆç•™ä¸€ç‚¹æœ€åŽè£…é¥°ï¼‰å’Œè’œæœ«çˆ†é¦™ã€‚
3. å€’å…¥è¥¿çº¢æŸ¿å—ï¼Œä¸­ç«ç¿»ç‚’ã€‚
4. **æŒ‰åŽ‹å‡ºæ±**ï¼šä¸€è¾¹ç‚’ä¸€è¾¹ç”¨é“²å­èƒŒæŒ‰åŽ‹è¥¿çº¢æŸ¿ï¼Œç›´åˆ°ç‚’å‡ºçº¢è‰²çš„æ±¤æ±ï¼ˆè¿™ä¸€æ­¥å«â€œå‡ºæ²™â€ï¼‰ã€‚
> **æ³¨æ„**ï¼šå¦‚æžœè¥¿çº¢æŸ¿å¤ªå¹²ä¸å‡ºæ±ï¼Œå¯ä»¥åŠ ä¸€å‹ºç•ªèŒ„é…±å’Œå°‘è®¸æ¸…æ°´ï¼Œæ±¤æ±ä¼šæ›´æµ“éƒã€‚



#### ç¬¬ä¸‰æ­¥ï¼šæ··åˆä¸Žè°ƒå‘³

1. çœ‹åˆ°è¥¿çº¢æŸ¿å˜è½¯å‡ºæ±åŽï¼Œå€’å…¥ä¹‹å‰ç‚’å¥½çš„é¸¡è›‹ã€‚
2. åŠ å…¥ **1 å‹ºç™½ç³–** å’Œ **é€‚é‡çš„ç›**ã€‚
3. å¿«é€Ÿç¿»ç‚’å‡åŒ€ï¼Œè®©é¸¡è›‹å¸æ»¡è¥¿çº¢æŸ¿çš„æ±¤æ±ï¼ˆçº¦ 30 ç§’ï¼‰ã€‚

#### ç¬¬å››æ­¥ï¼šå‡ºé”…

1. æ’’ä¸Šå‰©ä½™çš„è‘±èŠ±ç‚¹ç¼€ã€‚
2. å…³ç«è£…ç›˜ã€‚

---

### ðŸ’¡ å‡ ä¸ªè®©å¥½æ„Ÿåº¦å€å¢žçš„ Tips

* **å…ˆç‚’è¥¿çº¢æŸ¿è¿˜æ˜¯å…ˆç‚’è›‹ï¼Ÿ** ä¼ ç»Ÿçš„åšæ³•æ˜¯åˆ†æ­¥ç‚’ï¼ˆå¦‚ä¸Šï¼‰ã€‚è¿™æ ·é¸¡è›‹å«©ï¼Œè¥¿çº¢æŸ¿æ±æµ“ã€‚å¦‚æžœæ··åœ¨ä¸€èµ·ç‚’ï¼Œå–ç›¸å’Œå£æ„Ÿéƒ½ä¼šå·®å¾ˆå¤šã€‚
* **å…³äºŽç³–çš„ç”¨é‡**ï¼šè¿™é“èœçš„ç²¾é«“åœ¨äºŽâ€œé…¸ç”œå£â€ã€‚ç³–çš„ä½œç”¨ä¸æ˜¯ä¸ºäº†è®©èœå˜æˆç”œå“ï¼Œè€Œæ˜¯ä¸ºäº†ä¸­å’Œè¥¿çº¢æŸ¿çš„é…¸ï¼Œä½¿å‘³é“æ›´æŸ”å’Œã€‚å»ºè®®å°‘é‡å¤šæ¬¡å°è¯•ã€‚
* **æ‹Œé¥­ç¥žå™¨**ï¼šå¦‚æžœæƒ³ç”¨æ¥æ‹Œé¥­ï¼Œåœ¨ç‚’è¥¿çº¢æŸ¿æ—¶å¤šåŠ ä¸€ç‚¹ç‚¹æ°´ï¼Œä¿ç•™æ›´å¤šçš„æ±¤æ±ï¼Œå‘³é“ç»ä½³ã€‚
EOT;

        $dishes = [
            [
                'name' => 'è¥¿çº¢æŸ¿ç‚’é¸¡è›‹',
                'category' => 'ä¸‹é¥­çƒ­èœ',
                'description' => 'å›½æ°‘ç¬¬ä¸€èœï¼Œé…¸ç”œå¼€èƒƒï¼Œè€å°‘çš†å®œã€‚',
                'recipe' => $recipe_tomato_scrambled_eggs,
                'ingredients' => [
                    ['name' => 'è¥¿çº¢æŸ¿', 'qty' => 300, 'unit' => 'g', 'remark' => '2ä¸ª'],
                    ['name' => 'é¸¡è›‹', 'qty' => 3, 'unit' => 'pc', 'remark' => '3ä¸ª'],
                    ['name' => 'é£Ÿç”¨æ²¹', 'qty' => 30, 'unit' => 'ml', 'remark' => 'é€‚é‡'],
                    ['name' => 'ç›', 'qty' => 3, 'unit' => 'g', 'remark' => 'å°‘è®¸'],
                    ['name' => 'å¤§è‘±', 'qty' => 10, 'unit' => 'g', 'remark' => 'è‘±èŠ±'],
                    ['name' => 'ç™½ç³–', 'qty' => 5, 'unit' => 'g', 'remark' => 'æé²œ'],
                ]
            ],
            [
                'name' => 'é’æ¤’åœŸè±†ä¸',
                'category' => 'ä¸‹é¥­çƒ­èœ',
                'description' => 'æ¸…è„†çˆ½å£ï¼Œå®¶å¸¸å¿…å¤‡ã€‚',
                'ingredients' => [
                    ['name' => 'åœŸè±†', 'qty' => 400, 'unit' => 'g', 'remark' => '2ä¸ª'],
                    ['name' => 'é’æ¤’', 'qty' => 50, 'unit' => 'g', 'remark' => '1ä¸ª'],
                    ['name' => 'å¤§è’œ', 'qty' => 2, 'unit' => 'pc', 'remark' => '2ç“£'],
                    ['name' => 'ç±³é†‹', 'qty' => 15, 'unit' => 'ml', 'remark' => '1å‹º'],
                    ['name' => 'ç›', 'qty' => 3, 'unit' => 'g', 'remark' => 'é€‚é‡'],
                ]
            ],
            [
                'name' => 'çº¢çƒ§è‚‰',
                'category' => 'ä¸‹é¥­çƒ­èœ',
                'description' => 'è‚¥è€Œä¸è…»ï¼Œå…¥å£å³åŒ–ï¼Œéœ€è¦è€å¿ƒæ…¢ç‚–ã€‚',
                'ingredients' => [
                    ['name' => 'çŒªäº”èŠ±è‚‰', 'qty' => 500, 'unit' => 'g', 'remark' => '1æ–¤'],
                    ['name' => 'ç”Ÿå§œ', 'qty' => 10, 'unit' => 'g', 'remark' => '3ç‰‡'],
                    ['name' => 'å¤§è‘±', 'qty' => 20, 'unit' => 'g', 'remark' => '1æ®µ'],
                    ['name' => 'ç”ŸæŠ½', 'qty' => 15, 'unit' => 'ml', 'remark' => '1å‹º'],
                    ['name' => 'è€æŠ½', 'qty' => 10, 'unit' => 'ml', 'remark' => 'åŠå‹º'],
                    ['name' => 'æ–™é…’', 'qty' => 30, 'unit' => 'ml', 'remark' => '2å‹º'],
                    ['name' => 'å†°ç³–', 'qty' => 20, 'unit' => 'g', 'remark' => 'ä¸€æŠŠ'], // å‡è®¾æœ‰å†°ç³–ï¼Œæˆ–è€…ç”¨ç™½ç³–ä»£æ›¿
                ]
            ],
            [
                'name' => 'æ‹é»„ç“œ',
                'category' => 'å¼€èƒƒå‡‰èœ',
                'description' => 'å¤æ—¥æ¸…å‡‰ï¼Œç®€å•å¿«æ‰‹ã€‚',
                'ingredients' => [
                    ['name' => 'é»„ç“œ', 'qty' => 300, 'unit' => 'g', 'remark' => '2æ ¹'],
                    ['name' => 'å¤§è’œ', 'qty' => 5, 'unit' => 'pc', 'remark' => '5ç“£'],
                    ['name' => 'é¦™æ²¹', 'qty' => 5, 'unit' => 'ml', 'remark' => 'å°‘è®¸'],
                    ['name' => 'ç±³é†‹', 'qty' => 20, 'unit' => 'ml', 'remark' => '2å‹º'],
                    ['name' => 'ç›', 'qty' => 3, 'unit' => 'g', 'remark' => 'é€‚é‡'],
                ]
            ],
            [
                'name' => 'ç´«èœè›‹èŠ±æ±¤',
                'category' => 'æ»‹è¡¥æ±¤ç¾¹',
                'description' => 'å¿«æ‰‹æ±¤ï¼Œé²œç¾Žè§£è…»ã€‚',
                'ingredients' => [
                    ['name' => 'é¸¡è›‹', 'qty' => 1, 'unit' => 'pc', 'remark' => '1ä¸ª'],
                    ['name' => 'é¦™æ²¹', 'qty' => 3, 'unit' => 'ml', 'remark' => 'å‡ æ»´'],
                    ['name' => 'ç›', 'qty' => 2, 'unit' => 'g', 'remark' => 'å°‘è®¸'],
                    // ç´«èœç¼ºçœï¼Œæš‚ä¸æ·»åŠ ï¼Œæˆ–è€…åœ¨IngredientSeederåŠ ä¸€ä¸‹
                ]
            ],
        ];

        // Handle "Ice Sugar" missing in IngredientSeeder, fallback to sugar
        $sugarId = $ing('ç™½ç³–');

        foreach ($dishes as $data) {
            $catName = $data['category'];
            if (!isset($categories[$catName])) continue;

            $dish = Dish::firstOrCreate(
                ['name' => $data['name']],
                [
                    'category_id' => $categories[$catName],
                    'description' => $data['description'],
                    'recipe' => $data['recipe'] ?? null,
                    'frequency' => rand(0, 20),
                ]
            );

            // Sync Ingredients
            $syncData = [];
            foreach ($data['ingredients'] as $item) {
                $ingId = $ing($item['name']);

                // Fallback logic
                if (!$ingId && $item['name'] === 'å†°ç³–') $ingId = $sugarId;

                if ($ingId) {
                    $syncData[$ingId] = [
                        'quantity' => $item['qty'],
                        'unit' => $item['unit'],
                        'remark' => $item['remark'],
                    ];
                }
            }

            if (!empty($syncData)) {
                $dish->ingredients()->sync($syncData);
            }
        }
    }
}
